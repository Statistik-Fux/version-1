<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handball Statistik</title>

<!-- Cache verhindern -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<style>
body { font-family: Arial, sans-serif; margin: 0; background-color: #fff; }
body::before, body::after {
    content: ""; position: fixed; top: 50%; transform: translateY(-50%);
    width: 70vw; height: 90vh; background-repeat: no-repeat; background-position: center;
    background-size: contain; opacity: 0.15; filter: blur(0.5px);
    z-index: -1; pointer-events: none;
}
body::before { left: 15%; }
body::after { right: 15%; }
h1, h2 { text-align: center; margin-bottom: 15px; }
#setup {
    background: rgba(255, 255, 255, 0.6); padding: 20px; border-radius: 12px;
    max-width: 500px; margin: 30px auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
#opponent, #teamSelect {
    font-size: 1.1em; padding: 12px; width: 100%; margin-bottom: 20px;
    border: 1px solid #ccc; border-radius: 8px; background-color: rgba(255,255,255,0.85);
    transition: border-color 0.3s, box-shadow 0.3s; color: black;
}
#opponent:focus, #teamSelect:focus {
    outline: none; border-color: #009688; box-shadow: 0 0 5px rgba(0,150,136,0.5);
}
#player-selection { display: flex; gap: 10px; flex-wrap: nowrap; justify-content: space-between; }
#player-selection .column { width: 48%; display: flex; flex-direction: column; gap: 8px; }
#player-selection label { cursor: pointer; font-size: 1em; padding: 4px 0; }
#player-selection input[type="checkbox"] { margin-right: 6px; transform: scale(1.2); }
.add-player-container { margin-top: 15px; display: flex; gap: 5px; }
.add-player-container input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
.add-player-container select { margin-left:5px; padding:6px; border-radius:6px; border:1px solid #ccc; }
.add-player-container button {
    padding: 8px 12px; border: none; border-radius: 6px;
    background-color: #009688; color: white; cursor: pointer; font-size: 1em;
}
.add-player-container button:hover { background-color: #00796b; }
.start-btn {
    font-size: 1.3em; padding: 12px 15px; background: linear-gradient(90deg, #009688, #26a69a);
    color: white; border: none; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 20px;
    transition: background 0.3s, transform 0.1s;
}
.start-btn:hover { background: linear-gradient(90deg, #00796b, #26a69a); }
.start-btn:active { transform: scale(0.98); }
.player-card {
    border-radius: 8px; padding: 10px; margin: 10px; flex: 1; min-width: 250px;
    background: white; box-shadow: 0 3px 8px rgba(0,0,0,0.05);
}
.player-name { font-weight: bold; font-size: 1.4em; text-align: center; margin-bottom: 10px; }
.grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 10px; }
.btn {
    width: 31%; padding: 8px; margin: 2px 1%; border: none; cursor: pointer;
    font-size: 0.9em; border-radius: 6px; user-select: none;
}
.positive { background-color: #d4edda; }
.negative { background-color: #f8d7da; }
.full-width { width: 98%; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; background-color: white; font-size: 0.9em; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
th { background: #f0f0f0; }
.thick-separator { border-left: 3px solid black !important; }
.export-buttons { margin-top: 20px; text-align: center; }
.hidden { display: none; }
@media (max-width: 768px) {
    .btn { width: 48%; font-size: 0.85em; padding: 6px; }
    .player-card { min-width: unset; width: 100%; }
    #player-selection { flex-direction: column; }
    #player-selection .column { width: 100%; }
    table { font-size: 0.8em; }
}
</style>
</head>
<body>
    <main id="setup">
    <h1>Spielstatistik</h1>

    <label for="teamSelect">Team auswählen:</label>
    <select id="teamSelect">
        <option value="teamA">Team A</option>
        <option value="teamB">Team B</option>
    </select>

    <label for="opponent">Gegner:</label>
    <input type="text" id="opponent" placeholder="Gegnername eingeben">

    <div id="player-selection">
        <div class="column" id="teamA-list">
            <label><input type="checkbox" value="Spieler 1">Spieler 1</label>
            <label><input type="checkbox" value="Spieler 2">Spieler 2</label>
            <label><input type="checkbox" value="Spieler 3">Spieler 3</label>
        </div>
        <div class="column" id="teamB-list">
            <label><input type="checkbox" value="Spieler 4">Spieler 4</label>
            <label><input type="checkbox" value="Spieler 5">Spieler 5</label>
            <label><input type="checkbox" value="Spieler 6">Spieler 6</label>
        </div>
    </div>

    <div class="add-player-container">
        <input type="text" id="newPlayerName" placeholder="Neuen Spieler hinzufügen">
        <select id="newPlayerTeam">
            <option value="teamA">Team A</option>
            <option value="teamB">Team B</option>
        </select>
        <button id="addPlayerBtn">+</button>
    </div>

    <button id="startButton" class="start-btn">Start</button>
</main>

<main id="game" class="hidden">
    <h2 id="gameTitle">Spiel läuft</h2>
    <div id="playersContainer" class="grid"></div>

    <div id="teamStats"></div>

    <!-- ✨ Neuer Button: Tempotor-Export/Anzeige -->
    <div class="export-buttons hidden" id="pdfExportContainer">
        <button id="pdfExport">Gesamtstatistik als PDF</button>
    </div>

    <div class="export-buttons hidden" id="excelExportContainer">
        <button id="playerExport">Spielerstatistik (XLSX)</button>
        <button id="teamExport">Teamstatistik (XLSX)</button>
    </div>
</main>
<script>
document.addEventListener("DOMContentLoaded", () => {

    const startButton = document.getElementById("startButton");
    const playersContainer = document.getElementById("playersContainer");
    const setup = document.getElementById("setup");
    const game = document.getElementById("game");

    const playerExport = document.getElementById("playerExport");
    const teamExport = document.getElementById("teamExport");
    const pdfExport = document.getElementById("pdfExport");

    let playersData = {};
    let opponentName = "";

    // ✅ Aktionen
    const actionsPositive = ["Tor", "Assist", "Steal", "Tempotor"]; // <— Tempotor ergänzt
    const actionsNegative = ["Fehlpass", "Fehlwurf", "Technischer Fehler"];

    // Spielstart
    startButton.addEventListener("click", () => {
        const selected = document.querySelectorAll("#player-selection input[type=checkbox]:checked");
        if (selected.length === 0) {
            alert("Bitte mindestens einen Spieler auswählen!");
            return;
        }

        opponentName = document.getElementById("opponent").value || "Unbekannter Gegner";
        setup.classList.add("hidden");
        game.classList.remove("hidden");

        playersData = {};
        playersContainer.innerHTML = "";

        selected.forEach((checkbox) => {
            const name = checkbox.value;
            playersData[name] = {
                Tor: 0, Assist: 0, Steal: 0, Tempotor: 0,
                Fehlpass: 0, Fehlwurf: 0, "Technischer Fehler": 0,
                GesamtPositiv: 0, GesamtNegativ: 0
            };
            createPlayerCard(name);
        });

        document.getElementById("pdfExportContainer").classList.remove("hidden");
        document.getElementById("excelExportContainer").classList.remove("hidden");
        updateTables();
    });

    // Spielerkarte erstellen
    function createPlayerCard(name) {
        const card = document.createElement("div");
        card.className = "player-card";

        const title = document.createElement("div");
        title.className = "player-name";
        title.textContent = name;
        card.appendChild(title);

        actionsPositive.forEach((action) => {
            const btn = document.createElement("button");
            btn.className = "btn positive";
            btn.textContent = action;
            btn.addEventListener("click", () => addAction(name, action));
            card.appendChild(btn);
        });

        actionsNegative.forEach((action) => {
            const btn = document.createElement("button");
            btn.className = "btn negative";
            btn.textContent = action;
            btn.addEventListener("click", () => addAction(name, action));
            card.appendChild(btn);
        });

        playersContainer.appendChild(card);
    }

    // Aktionen zählen
    function addAction(player, action) {
        if (!playersData[player]) return;
        playersData[player][action]++;
        updateTables();
    }

    // Statistik aktualisieren
    function updateTables() {
        // Summen neu berechnen
        for (const player in playersData) {
            const p = playersData[player];
            p.GesamtPositiv = p.Tor + p.Assist + p.Steal + p.Tempotor;
            p.GesamtNegativ = p.Fehlpass + p.Fehlwurf + p["Technischer Fehler"];
        }

        // HTML-Tabelle bauen
        let html = "<table><tr><th>Spieler</th>";
        actionsPositive.forEach(a => html += `<th>${a}</th>`);
        actionsNegative.forEach(a => html += `<th>${a}</th>`);
        html += "<th>Gesamt +</th><th>Gesamt -</th></tr>";

        for (const player in playersData) {
            const p = playersData[player];
            html += `<tr><td>${player}</td>`;
            actionsPositive.forEach(a => html += `<td>${p[a]}</td>`);
            actionsNegative.forEach(a => html += `<td>${p[a]}</td>`);
            html += `<td>${p.GesamtPositiv}</td><td>${p.GesamtNegativ}</td></tr>`;
        }
        html += "</table>";

        document.getElementById("teamStats").innerHTML = html;
    }

    // Beispielhafte Exporte (funktionieren wie gehabt)
    if (pdfExport) {
        pdfExport.addEventListener("click", () => {
            alert("PDF-Export folgt hier wie bisher.");
        });
    }

    if (playerExport) {
        playerExport.addEventListener("click", () => {
            alert("Excel-Export: Spielerstatistik (Platzhalter).");
        });
    }

    if (teamExport) {
        teamExport.addEventListener("click", () => {
            alert("Excel-Export: Teamstatistik (Platzhalter).");
        });
    }

});
</script>
</body>
</html>
